// Javascript code shared by all views generated by the athome controller

$(document).ready(function(){
  updateNoteForm();
});

// Updates the note form found on all athome views to enable javascript behaviors
function updateNoteForm() {
  // check that there is a rails-generated new-note form on this page
  var f = $('#new_note');
  if(f.length == 0) {
    alert("updateNoteForm called on page with no new-note form");
    return;
  }
  // if we have a default user, replace the selector with the name and a change link
  if($('#note_user_id option[selected]').length == 1) {
    $('#note_user_id').hide();
    $('#note_by').append("<span id='note_user'>" + $("#note_user_id :selected").text() +
      " (<a href='#'>change</a>)</span>");
    $('#note_user a').click(function() {
      $('#note_user').fadeOut('fast',function() {$('#note_user_id').fadeIn('fast');});
      return false;
    });
  }
  // replace the submit button with a link to an Ajax action
  f.submit(function(){
    $.post($(this).attr('action')+'.txt',$(this).serialize(),function(data) {
      // if the request is successful...
      $('#note_save').html(data).delay(1000).fadeOut('fast',function() {
        $('#note_body').val("Click again to enter another note...");
        $('#note_save').html("<a href='#'>Save</a>").fadeIn();
        $('#note_save a').click(function() {
          f.submit();
          return false;
        })
      });
    },"text");
    return false; // don't actually submit this form
  });
  
}